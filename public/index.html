<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NotesAura AI Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/11.1.1/marked.min.js"></script>
</head>
<body>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0f0f0f; color: #fff; height: 100vh; overflow: hidden; }
.app { display: flex; height: 100vh; }
.sidebar { width: 280px; background: #171717; border-right: 1px solid #2a2a2a; display: flex; flex-direction: column; transition: 0.3s; }
.sidebar.hidden { margin-left: -280px; }
.sidebar-header { padding: 20px; border-bottom: 1px solid #2a2a2a; }
.new-chat-btn { width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; }
.new-chat-btn:hover { opacity: 0.9; }
.history-list { flex: 1; overflow-y: auto; padding: 10px; }
.history-item { padding: 12px; margin: 5px 0; background: #1f1f1f; border-radius: 8px; cursor: pointer; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.history-item:hover { background: #2a2a2a; }
.history-item.active { background: #667eea; }
.main-content { flex: 1; display: flex; flex-direction: column; }
.top-bar { height: 60px; background: #171717; border-bottom: 1px solid #2a2a2a; display: flex; align-items: center; padding: 0 20px; gap: 15px; }
.menu-btn { width: 40px; height: 40px; background: #2a2a2a; border: none; border-radius: 8px; color: white; cursor: pointer; font-size: 20px; }
.menu-btn:hover { background: #3a3a3a; }
.top-bar h1 { font-size: 20px; flex: 1; }
.theme-btn, .settings-btn { width: 40px; height: 40px; background: #2a2a2a; border: none; border-radius: 8px; color: white; cursor: pointer; }
.theme-btn:hover, .settings-btn:hover { background: #3a3a3a; }
.chat-area { flex: 1; overflow-y: auto; padding: 30px; }
.message { display: flex; gap: 15px; margin-bottom: 30px; animation: fadeIn 0.3s; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.message.user { justify-content: flex-end; }
.avatar { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0; }
.message.user .avatar { background: linear-gradient(135deg, #667eea, #764ba2); order: 2; }
.message.ai .avatar { background: linear-gradient(135deg, #f093fb, #f5576c); }
.msg-content { max-width: 70%; padding: 15px 20px; border-radius: 16px; line-height: 1.6; }
.message.user .msg-content { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-bottom-right-radius: 4px; }
.message.ai .msg-content { background: #1f1f1f; border: 1px solid #2a2a2a; border-bottom-left-radius: 4px; }
.msg-content pre { background: #0a0a0a; border-radius: 8px; padding: 15px; margin: 10px 0; overflow-x: auto; position: relative; }
.msg-content code { font-family: 'Consolas', monospace; font-size: 14px; }
.msg-content pre code { background: none; padding: 0; color: #abb2bf; }
.msg-content :not(pre) > code { background: #2a2a2a; color: #f093fb; padding: 2px 6px; border-radius: 4px; }
.copy-btn { position: absolute; top: 8px; right: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 11px; }
.copy-btn:hover { background: rgba(255,255,255,0.2); }
.input-area { padding: 20px; background: #171717; border-top: 1px solid #2a2a2a; }
.input-wrapper { display: flex; gap: 10px; max-width: 1200px; margin: 0 auto; }
#messageInput { flex: 1; padding: 15px 20px; background: #1f1f1f; border: 1px solid #2a2a2a; border-radius: 12px; color: white; font-size: 15px; outline: none; resize: none; font-family: inherit; max-height: 120px; }
#messageInput:focus { border-color: #667eea; }
.send-btn { padding: 15px 30px; background: linear-gradient(135deg, #667eea, #764ba2); border: none; border-radius: 12px; color: white; font-weight: 600; cursor: pointer; }
.send-btn:hover:not(:disabled) { opacity: 0.9; }
.send-btn:disabled { opacity: 0.5; cursor: not-allowed; }
.typing { display: none; padding: 15px 20px; background: #1f1f1f; border-radius: 16px; width: 70px; }
.typing.active { display: flex; gap: 5px; }
.typing span { width: 8px; height: 8px; background: #667eea; border-radius: 50%; animation: bounce 1.4s infinite; }
.typing span:nth-child(2) { animation-delay: 0.2s; }
.typing span:nth-child(3) { animation-delay: 0.4s; }
@keyframes bounce { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-10px); } }
.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; }
.modal.active { display: flex; }
.modal-content { background: #171717; border-radius: 16px; padding: 30px; max-width: 500px; width: 90%; border: 1px solid #2a2a2a; }
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
.modal-header h2 { font-size: 22px; }
.close-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; }
.setting-item { margin: 20px 0; }
.setting-item label { display: block; margin-bottom: 8px; font-size: 14px; color: #aaa; }
.setting-item select, .setting-item input { width: 100%; padding: 10px; background: #1f1f1f; border: 1px solid #2a2a2a; border-radius: 8px; color: white; font-size: 14px; }
@media (max-width: 768px) {
.sidebar { position: fixed; z-index: 100; height: 100vh; }
.sidebar.hidden { margin-left: -280px; }
.msg-content { max-width: 85%; }
}
</style>

<div class="app">
<div class="sidebar" id="sidebar">
<div class="sidebar-header">
<button class="new-chat-btn" onclick="newChat()">‚ûï New Chat</button>
</div>
<div class="history-list" id="historyList"></div>
</div>

<div class="main-content">
<div class="top-bar">
<button class="menu-btn" onclick="toggleSidebar()">‚ò∞</button>
<h1>NotesAura AI Pro</h1>
<button class="theme-btn" onclick="toggleTheme()">üåô</button>
<button class="settings-btn" onclick="openSettings()">‚öôÔ∏è</button>
</div>

<div class="chat-area" id="chatArea">
<div class="message ai">
<div class="avatar">ü§ñ</div>
<div class="msg-content">
<p>Hello! I'm NotesAura AI Pro. How can I help you today?</p>
</div>
</div>
</div>

<div class="typing" id="typing">
<span></span><span></span><span></span>
</div>

<div class="input-area">
<div class="input-wrapper">
<textarea id="messageInput" placeholder="Type your message..." rows="1"></textarea>
<button class="send-btn" id="sendBtn" onclick="sendMessage()">Send</button>
</div>
</div>
</div>
</div>

<div class="modal" id="settingsModal">
<div class="modal-content">
<div class="modal-header">
<h2>Settings</h2>
<button class="close-btn" onclick="closeSettings()">√ó</button>
</div>
<div class="setting-item">
<label>Model Temperature</label>
<input type="range" min="0" max="1" step="0.1" value="0.7" id="temperature">
</div>
<div class="setting-item">
<label>Max Tokens</label>
<input type="number" value="1000" id="maxTokens">
</div>
<div class="setting-item">
<label>Font Size</label>
<select id="fontSize">
<option value="14px">Small</option>
<option value="15px" selected>Medium</option>
<option value="16px">Large</option>
</select>
</div>
</div>
</div>

<script>
let chats = JSON.parse(localStorage.getItem('chats')) || [];
let currentChatId = null;

marked.setOptions({ breaks: true, gfm: true, highlight: (code, lang) => lang && hljs.getLanguage(lang) ? hljs.highlight(code, { language: lang }).value : hljs.highlightAuto(code).value });

document.getElementById('messageInput').addEventListener('input', function() {
this.style.height = 'auto';
this.style.height = Math.min(this.scrollHeight, 120) + 'px';
});

document.getElementById('messageInput').addEventListener('keydown', (e) => {
if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
});

function toggleSidebar() {
document.getElementById('sidebar').classList.toggle('hidden');
}

function toggleTheme() {
document.body.style.background = document.body.style.background === 'rgb(255, 255, 255)' ? '#0f0f0f' : '#fff';
}

function openSettings() {
document.getElementById('settingsModal').classList.add('active');
}

function closeSettings() {
document.getElementById('settingsModal').classList.remove('active');
}

function newChat() {
currentChatId = Date.now();
chats.push({ id: currentChatId, title: 'New Chat', messages: [] });
saveChats();
loadHistory();
document.getElementById('chatArea').innerHTML = '<div class="message ai"><div class="avatar">ü§ñ</div><div class="msg-content"><p>Hello! I\'m NotesAura AI Pro. How can I help you today?</p></div></div>';
}

function loadHistory() {
const list = document.getElementById('historyList');
list.innerHTML = chats.map(chat => `<div class="history-item ${chat.id === currentChatId ? 'active' : ''}" onclick="loadChat(${chat.id})">${chat.title}</div>`).join('');
}

function loadChat(id) {
currentChatId = id;
const chat = chats.find(c => c.id === id);
if (!chat) return;
const area = document.getElementById('chatArea');
area.innerHTML = chat.messages.map(m => `<div class="message ${m.role}"><div class="avatar">${m.role === 'user' ? 'üë§' : 'ü§ñ'}</div><div class="msg-content">${m.role === 'user' ? m.content : parseMessage(m.content)}</div></div>`).join('');
loadHistory();
area.scrollTop = area.scrollHeight;
}

function saveChats() {
localStorage.setItem('chats', JSON.stringify(chats));
}

function parseMessage(content) {
let html = marked.parse(content);
html = html.replace(/<pre><code class="language-(\w+)">([\s\S]*?)<\/code><\/pre>/g, (m, lang, code) => `<pre><code class="language-${lang}">${code}</code><button class="copy-btn" onclick="copyCode(this)">üìã</button></pre>`);
html = html.replace(/<pre><code>([\s\S]*?)<\/code><\/pre>/g, (m, code) => `<pre><code>${code}</code><button class="copy-btn" onclick="copyCode(this)">üìã</button></pre>`);
return html;
}

function addMessage(content, role) {
const area = document.getElementById('chatArea');
const div = document.createElement('div');
div.className = `message ${role}`;
div.innerHTML = `<div class="avatar">${role === 'user' ? 'üë§' : 'ü§ñ'}</div><div class="msg-content">${role === 'user' ? content : parseMessage(content)}</div>`;
area.appendChild(div);
if (role === 'ai') div.querySelectorAll('pre code').forEach(block => hljs.highlightElement(block));
area.scrollTop = area.scrollHeight;
}

function copyCode(btn) {
const code = btn.previousElementSibling.textContent;
navigator.clipboard.writeText(code).then(() => {
btn.innerHTML = '‚úì';
setTimeout(() => btn.innerHTML = 'üìã', 2000);
});
}

async function sendMessage() {
const input = document.getElementById('messageInput');
const message = input.value.trim();
if (!message) return;

if (!currentChatId) newChat();

addMessage(message, 'user');
const chat = chats.find(c => c.id === currentChatId);
chat.messages.push({ role: 'user', content: message });
if (chat.title === 'New Chat') chat.title = message.substring(0, 30);
saveChats();
loadHistory();

input.value = '';
input.style.height = 'auto';
document.getElementById('sendBtn').disabled = true;
document.getElementById('typing').classList.add('active');

try {
const res = await fetch('/api/chat', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ message, history: chat.messages.slice(0, -1) })
});
const data = await res.json();
document.getElementById('typing').classList.remove('active');
if (data.success) {
addMessage(data.response, 'ai');
chat.messages.push({ role: 'ai', content: data.response });
saveChats();
}
} catch (error) {
document.getElementById('typing').classList.remove('active');
addMessage('Failed to connect to server', 'ai');
} finally {
document.getElementById('sendBtn').disabled = false;
input.focus();
}
}

if (chats.length === 0) newChat();
else { currentChatId = chats[chats.length - 1].id; loadChat(currentChatId); }
loadHistory();
</script>
</body>
</html>
